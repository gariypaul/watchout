<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Item to Sell</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        header {
            margin-bottom: 20px;
        }

        .navbar {
            margin-bottom: 20px;
        }

        .card {
            margin-bottom: 20px;
        }

        footer {
            margin-top: 20px;
            padding: 20px 0;
            text-align: center;
        }

        #log-out{
        margin-left: auto;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="#">Add Item to Sell</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="home.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="listings.html">Listings</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./SignIn.html">Sign In</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="additem.html">Add Item</a>
                    </li>
                </ul>
                <button type="button" class="btn btn-dark" id="log-out" onclick="logout()">Log Out</button>
            </div>
        </div>
    </nav>
    <div id="protected-content" style="display:none">
    <section class="container">
        <h2 class="text-center mb-4">Add a New Watch Listing</h2>
        <form id="watchForm">
            <div class="mb-3">
                <label for="watchName" class="form-label">Watch Name</label>
                <input type="text" class="form-control" id="watchName" placeholder="Enter watch name" required>
            </div>
            <div class="mb-3">
                <label for="watchPrice" class="form-label">Price</label>
                <input type="number" class="form-control" id="watchPrice" placeholder="Enter price" required>
            </div>
            <div class="mb-3">
                <label for="watchSize" class="form-label">Size</label>
                <input type="text" class="form-control" id="watchSize" placeholder="Enter size" required>
            </div>
            <div class="mb-3">
                <label for="watchMaterial" class="form-label">Material</label>
                <input type="text" class="form-control" id="watchMaterial" placeholder="Enter material" required>
            </div>
            <div class="mb-3">
                <label for="watchDescription" class="form-label">Description</label>
                <textarea class="form-control" id="watchDescription" rows="5" placeholder="Enter a detailed description"
                    required></textarea>
            </div>
            <div class="mb-3">
                <label for="watchImage" class="form-label">Watch Image</label>
                <input type="file" class="form-control" id="watchImage" required>
            </div>
            <div class="text-center">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
    </section>
    </div>
    <footer class="bg-light">
        &copy; 2023 My Website. All rights reserved.
    </footer>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-storage.js";
        import { getAuth, createUserWithEmailAndPassword, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyATTLXHrjxowvjDwokc8unc1bOc6veqdCw",
            authDomain: "watchout-84cc5.firebaseapp.com",
            databaseURL: "https://watchout-84cc5-default-rtdb.firebaseio.com",
            projectId: "watchout-84cc5",
            storageBucket: "watchout-84cc5.appspot.com",
            messagingSenderId: "73851933764",
            appId: "1:73851933764:web:54b79f1c6137923196d811"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        document.getElementById('watchForm').addEventListener('submit', (e) => {
            e.preventDefault();

            // Get form values
            const watchName = document.getElementById('watchName').value;
            const watchPrice = document.getElementById('watchPrice').value;
            const watchSize = document.getElementById('watchSize').value;
            const watchMaterial = document.getElementById('watchMaterial').value;
            const watchDescription = document.getElementById('watchDescription').value;
            const watchImage = document.getElementById('watchImage').files[0];

            // Firebase database reference
            const watchesRef = ref(db, 'watches');
            const newWatchRef = push(watchesRef);

            // Upload image to Firebase Storage
            const storageReference = storageRef(storage, 'watch_images/' + watchImage.name);
            const uploadTask = uploadBytes(storageReference, watchImage);

            uploadTask.then(snapshot => {
                getDownloadURL(snapshot.ref).then(downloadURL => {
                    // Create the watch item in the database
                    set(newWatchRef, {
                        name: watchName,
                        price: watchPrice,
                        size: watchSize,
                        material: watchMaterial,
                        description: watchDescription,
                        imageUrl: downloadURL
                    });

                    // Reset the form after successful submission
                    document.getElementById('watchForm').reset();
                    alert('Watch listing added successfully!');
                });
            }).catch(error => {
                console.error('Error uploading image: ', error);
            });
        });

        const auth = getAuth();
        auth.onAuthStateChanged(function(user){
            if(user){
                document.getElementById("protected-content").style.display="block";
            }else{
                document.getElementById("protected-content").style.display="none";
                window.location.href='SignIn.html'
            }
        });

        function logout(){
            signOut(auth).then(()=>{
                alert("Logged out");
                window.location.href="home.html";
            }).catch((error)=>{
                alert("Sign out error", error);
            });
        }

        document.addEventListener('DOMContentLoaded', (event)=>{
            document.getElementById("log-out").addEventListener('click', logout);
        });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>